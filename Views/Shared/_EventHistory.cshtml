@model IEnumerable<HaBuddies.Models.Event>;
@using HaBuddies.Models
@using HaBuddies.Constants
@using static HaBuddies.Services.Utils.EventUtil
@using Newtonsoft.Json;

@{
    string userExist = ViewContext.HttpContext.Session.GetString("user")!;
    UserNoPassword userObject = null!;
    if (userExist != null) {
        userObject = JsonConvert.DeserializeObject<UserNoPassword>(userExist)!;
    }
}
    @foreach (Event evt in Model)
    {
        var category = evt.Category;
        int currentEnroll = evt.SubscribersId.Count;
        string enrollMsg =$"{currentEnroll}";

        bool selfOwned = IsOwnedEvent(userObject, evt);
        bool canJoin = IsJoinable(userObject, evt);
        bool currentlyJoin = IsCurrentlyJoined(userObject, evt);
        
        <div class="banner" id="@evt.Id">
            <a draggable="false" asp-controller="Event" asp-action="Details" asp-route-id="@evt.Id">
                <div class="evt-heading">
                    <div class="category" style="background-color: @Category.GetColorHex(category)">
                        @Html.Raw(Category.GetIconHtml(category))
                        <span class="evt-category">@category</span>
                    </div>
                    <h2 class="evt-title">@evt.Title</h2>
                    <span class="evt-enrollsize @currentEnroll">
                        @enrollMsg <i class="fa-solid fa-user-group"></i>
                    </span>
                    <div class="owner">
                        <div class="owner-picture">
                            <img alt="Owner picture" src="~/img/default.jpg" draggable="false">
                        </div>
                        <span class="owner-name">@evt.Owner.Name @evt.Owner.Surname</span>
                    </div>
                </div>
                <div class="evt-body">
                    <span class="evt-description">@evt.Description</span>
                    <span class="evt-enddate">Close Date<br>@evt.EndDate.ToShortDateString()</span>
                </div>
            </a>
        </div>
    }
    <script>
        function myFunction(element) {
            var bannerId = element.parentElement.id;
            if (element.classList.contains("join")) {
                alert("Joined " + bannerId);
            }
            else {
                alert("Left " + bannerId);
            }
        }
    </script>
    
